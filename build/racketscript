#!/bin/bash
source "${BASH_SOURCE[0]%/*}/env.sh"

: ${RACKET_CONSOLE_BIN_DIR:="$(racket -e "(require setup/dirs) (display (find-user-console-bin-dir))")"}
: ${RACKS_BIN:="${RACKET_CONSOLE_BIN_DIR}/racks"}
[ -e "$RACKS_BIN" ] || raco pkg install racketscript

PLTCOLLECTS=":${PWD}/src/racket/" "$RACKS_BIN" --target traceur-browser -d tmp/racks \
  "$@" src/waxeye/racketscript.rkt
mkdir -p docs/site/genfiles/
cp tmp/racks/node_modules/traceur/bin/traceur-runtime.js docs/site/genfiles/
cp tmp/racks/dist/compiled.js docs/site/genfiles/racketscript-waxeye-compiler.js
